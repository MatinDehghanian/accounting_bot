# PasarGuard Accounting Bot

<div align="center">
  <img src="https://img.shields.io/badge/Python-3.8+-blue.svg" alt="Python Version">
  <img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License">
  <img src="https://img.shields.io/github/workflow/status/PasarGuard/accounting-bot/CI/CD" alt="Build Status">
  <img src="https://img.shields.io/codecov/c/github/PasarGuard/accounting-bot" alt="Coverage">
</div>

<div align="center">
  <h3>๐ค ุฑุจุงุช ุชูฺฏุฑุงู ููุดููุฏ ุจุฑุง ูุฏุฑุช ุญุณุงุจโูฺฉุชุงุจ ฺฉุงุฑุจุฑุงู</h3>
  <p>ุณุณุชู ูพุดุฑูุชู ูพุฑุฏุงุฒุด webhook ูุง PasarGuard ุจุง ูุงุจูุชโูุง ุชุนุงูู ู ูุณุฑุงุจ ููุดููุฏ</p>
</div>

---

## ูฺฺฏโูุง

- ๐ **ูพุฑุฏุงุฒุด ุฎูุฏฺฉุงุฑ webhook ูุง**: ุฏุฑุงูุช ู ูพุฑุฏุงุฒุด ุฑูุฏุงุฏูุง `user_created` ู `user_updated`
- ๐ **ูุณุฑุงุจ ููุดููุฏ**: ุงุฑุณุงู ูพุงู ุจู ุชุงูพฺฉ ุงุฎุชุตุงุต ูุฑ ุงุฏูู
- โก **ููุชุฑูฺฏ ูพุดุฑูุชู**: ุงุฑุณุงู ูพุงู ููุท ุฏุฑ ุดุฑุงุท ูุดุฎุต (ุงูุฒุงุด ุงููุถุง โฅ7 ุฑูุฒ ุง ุชุบุฑ ุจู on_hold)
- ๐ฎ **ุฏฺฉููโูุง ุชุนุงูู**: ูพฺฏุฑ ูุถุนุช ูพุฑุฏุงุฎุช ู ุงุถุงูู ฺฉุฑุฏู ุจู ูุณุช ุชุณูู
- ๐พ **ูพุงฺฏุงู ุฏุงุฏู ูุญู**: ุฐุฎุฑู snapshot ูุง ู ุงุทูุงุนุงุช ุญุณุงุจโูฺฉุชุงุจ
- ๐ **ููฺฏุงูโุณุงุฒ**: ุงูฺฉุงู sync ุงููู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑุงู

## ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### 1. ฺฉููู ฺฉุฑุฏู ูพุฑูฺู

```bash
git clone <repository-url>
cd accounting_bot
```

### 2. ูุตุจ ุฎูุฏฺฉุงุฑ

```bash
chmod +x setup.sh
./setup.sh
```

### 3. ุชูุธูุงุช

`.env` ูุงู ุฑุง ูุฑุงุด ฺฉูุฏ:

```bash
# Telegram Bot Token (ุงุฒ @BotFather ุฏุฑุงูุช ฺฉูุฏ)
BOT_TOKEN=1234567890:ABC-DEF1234ghIkl-zyx57W2v1u123ew11

# Secret ูุจููฺฉ (ุงุฎุชุงุฑ)
WEBHOOK_SECRET=your_webhook_secret_here

# ุชุงูพฺฉ fallback ุจุฑุง ุงุฏููโูุง ุจุฏูู mapping
FALLBACK_CHAT_ID=-1001234567890
FALLBACK_TOPIC_ID=123

# ุณุงุฑ ุชูุธูุงุช...
```

### 4. ุฑุงูโุงูุฏุงุฒ

```bash
# ูุนุงู ฺฉุฑุฏู virtual environment
source venv/bin/activate

# ุงุฌุฑุง ุฑุจุงุช
python main.py
```

## ุงุณุชูุงุฏู

### ุฏุณุชูุฑุงุช ุฑุจุงุช

- `/start` - ุดุฑูุน ู ุฎูุดโุขูุฏฺฏู
- `/help` - ุฑุงูููุง ฺฉุงูู
- `/sync` - ููฺฏุงูโุณุงุฒ ุงููู ฺฉุงุฑุจุฑุงู
- `/set_admin_topic` - ุชูุธู ุชุงูพฺฉ ุงุฎุชุตุงุต ุจุฑุง ุงุฏูู
- `/list_admins` - ูุดุงูุฏู ุงุฏููโูุง ู ุชุงูพฺฉโูุง
- `/stats` - ุขูุงุฑ ุณุณุชู

### ุชูุธู ุชุงูพฺฉ ุงุฏูู

1. ุฏุณุชูุฑ `/set_admin_topic` ุฑุง ุงุฌุฑุง ฺฉูุฏ
2. Telegram ID ุงุฏูู ุฑุง ูุงุฑุฏ ฺฉูุฏ (ุงุฒ @userinfobot ุฏุฑุงูุช ฺฉูุฏ)
3. Chat ID ฺฏุฑูู ููุตุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
4. ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ Topicุ Topic ID ุฑุง ูู ุงุถุงูู ฺฉูุฏ

### ุชูุธู Webhook ุฏุฑ ูพูู

ุฏุฑ ุชูุธูุงุช webhook ูพูู PasarGuard:

```
URL: https://your-server.com/webhook
Secret: your_webhook_secret_here (ุงุฎุชุงุฑ)
```

## ุณุงุฎุชุงุฑ ูพุงูโูุง

### user_created
ููุดู ุงุฑุณุงู ูโุดูุฏ:

```
๐งพ ุญุณุงุจโูฺฉุชุงุจ | user_created

๐ค User: username (id: 123)  
๐ฎ Admin: admin_name (tg_id: 987654321)

ุฌุฒุฆุงุช:
โก Status: active
๐ Data Limit: 10.0 GB
๐ Expire: 1403/12/15 - 14:30
๐ Created: 1403/11/20 - 10:15
```

### user_updated  
ููุท ุฏุฑ ุงู ุดุฑุงุท ุงุฑุณุงู ูโุดูุฏ:
- ุงูุฒุงุด ุงููุถุง ุญุฏุงูู 7 ุฑูุฒ
- ุชุบุฑ ูุถุนุช ุจู `on_hold`

## ุฏฺฉููโูุง ุชุนุงูู

ูุฑ ูพุงู ุดุงูู 3 ุฏฺฉูู:

- **ูพุฑุฏุงุฎุช ฺฉุฑุฏ โ**: ุซุจุช ูพุฑุฏุงุฎุช ูููู
- **ูพุฑุฏุงุฎุช ูฺฉุฑุฏ โ**: ุซุจุช ุนุฏู ูพุฑุฏุงุฎุช  
- **โ ุงูุฒูุฏู ุจู ูุณุช ุชุณูู**: ุงุถุงูู ฺฉุฑุฏู ุจู ููุฑุณุช ุชุณูู

ฺฉูฺฉ ุฑู ูุฑ ุฏฺฉููุ ูพุงู ุฑุง ุจุฑูุฒุฑุณุงู ูโฺฉูุฏ ู ูุชุฌู ุฑุง ุซุจุช ูโฺฉูุฏ.

## ุณุงุฎุชุงุฑ ูพุงฺฏุงู ุฏุงุฏู

- `users_snapshot`: ุนฺฉุณโุจุฑุฏุงุฑ ุขุฎุฑู ูุถุนุช ฺฉุงุฑุจุฑุงู
- `payments`: ูุถุนุช ูพุฑุฏุงุฎุช ูุฑ ฺฉุงุฑุจุฑ
- `settlement_list`: ูุณุช ฺฉุงุฑุจุฑุงู ูุงุฒููุฏ ุชุณูู
- `admin_topics`: mapping ุงุฏููโูุง ุจู ุชุงูพฺฉโูุง
- `audit_log`: ูุงฺฏ ุชูุงู ุนููุงุช

## API Endpoints

- `POST /webhook` - ุฏุฑุงูุช webhook ูุง PasarGuard
- `GET /health` - ูุถุนุช ุณูุงูุช ุณุณุชู
- `GET /stats` - ุขูุงุฑ ุณุณุชู

## ูฺฉุงุช ููู

1. **ููฺฏุงูโุณุงุฒ ุงููู**: ุญุชูุงู ูุจู ุงุฒ ุงุณุชูุงุฏูุ ุฏุณุชูุฑ `/sync` ุฑุง ุงุฌุฑุง ฺฉูุฏ
2. **ุชุงูพฺฉ mapping**: ุจุฑุง ูุฑ ุงุฏูู ุชุงูพฺฉ ุงุฎุชุตุงุต ุชูุธู ฺฉูุฏ
3. **Fallback**: ูพุงูโูุง ุงุฏููโูุง ุจุฏูู mapping ุจู ุชุงูพฺฉ fallback ุงุฑุณุงู ูโุดูุฏ
4. **ูุงฺฏโูุง**: ุชูุงู ุนููุงุช ุฏุฑ audit_log ุซุจุช ูโุดูุฏ

## ูุดฺฉูุงุช ุฑุงุฌ

### ุฎุทุง "Bot not found"
- Token ุฑุจุงุช ุฑุง ฺฺฉ ฺฉูุฏ
- ุฑุจุงุช ุฑุง `/start` ฺฉูุฏ

### ุฎุทุง "Chat not found"  
- Chat ID ุฑุง ุจุฑุฑุณ ฺฉูุฏ
- ุฑุจุงุช ุฑุง ุจู ฺฏุฑูู ุงุถุงูู ฺฉูุฏ
- ูุฌูุฒูุง ุฑุจุงุช ุฑุง ฺฺฉ ฺฉูุฏ

### ูพุงูโูุง user_updated ุงุฑุณุงู ููโุดูุฏ
- ุงูู `/sync` ฺฉูุฏ
- ุดุฑุงุท trigger ุฑุง ฺฺฉ ฺฉูุฏ (7+ ุฑูุฒ ุงูุฒุงุด ุงููุถุง ุง ุชุบุฑ ุจู on_hold)

## ูพุดุชุจุงู

ุจุฑุง ุณูุงูุงุช ู ูุดฺฉูุงุช:

- ๐ **Issues**: [ฺฏุฒุงุฑุด ูุดฺฉู ุง ูพุดููุงุฏ](https://github.com/PasarGuard/accounting-bot/issues)
- ๐ฌ **Discussions**: [ุจุญุซโูุง ุนููู](https://github.com/PasarGuard/accounting-bot/discussions)
- ๐ง **Email**: support@pasarguard.com
- ๐ **Wiki**: [ูุณุชูุฏุงุช ุชฺฉูู](https://github.com/PasarGuard/accounting-bot/wiki)

## ูุดุงุฑฺฉุช

ูุง ุงุฒ ูุดุงุฑฺฉุช ุฌุงูุนู ุงุณุชูุจุงู ูโฺฉูู! 

- ๐ค [ุฑุงูููุง ูุดุงุฑฺฉุช](CONTRIBUTING.md)
- ๐ [ฺฏุฒุงุฑุด ุจุงฺฏ](https://github.com/PasarGuard/accounting-bot/issues/new?template=bug_report.md)
- โจ [ูพุดููุงุฏ ูฺฺฏ](https://github.com/PasarGuard/accounting-bot/issues/new?template=feature_request.md)

## ูุฌูุฒ

ุงู ูพุฑูฺู ุชุญุช ูุฌูุฒ [MIT License](LICENSE) ููุชุดุฑ ุดุฏู ุงุณุช.

## ุชุดฺฉุฑ

ุงุฒ ุชูุงู ฺฉุณุงู ฺฉู ุฏุฑ ุชูุณุนู ุงู ูพุฑูฺู ูุดุงุฑฺฉุช ฺฉุฑุฏูโุงูุฏ ุชุดฺฉุฑ ูโฺฉูู โค๏ธ

---

<div align="center">
  <p>ุณุงุฎุชู ุดุฏู ุจุง โค๏ธ ุชูุณุท <a href="https://github.com/PasarGuard">PasarGuard Team</a></p>
  <p>โญ ุงฺฏุฑ ุงู ูพุฑูฺู ุจุฑุงุชุงู ููุฏ ุจูุฏุ ุญูุงุชุชุงู ุฑุง ุจุง ุฏุงุฏู ุณุชุงุฑู ูุดุงู ุฏูุฏ</p>
</div>